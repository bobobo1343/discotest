<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Google Drive Music Browser</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f0f0;
    color: #222;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark {
    background: #121212;
    color: #ddd;
  }
  header {
    background: #007acc;
    color: white;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  header h1 {
    margin: 0;
  }
  #darkToggle {
    background: #005a9e;
    border: none;
    color: white;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  #darkToggle:hover {
    background: #003d6a;
  }
  nav#breadcrumbs {
    padding: 10px 30px;
    background: #e0e0e0;
    font-size: 14px;
    user-select: none;
  }
  body.dark nav#breadcrumbs {
    background: #222;
  }
  nav#breadcrumbs span {
    cursor: pointer;
    padding: 3px 8px;
    border-radius: 4px;
    margin-right: 5px;
    display: inline-block;
  }
  nav#breadcrumbs span:hover {
    background: #b0d4ff;
  }
  body.dark nav#breadcrumbs span:hover {
    background: #1a3b6f;
  }
  nav#breadcrumbs span.current {
    cursor: default;
    font-weight: bold;
    background: #ccc;
  }
  body.dark nav#breadcrumbs span.current {
    background: #444;
  }
  main#content {
    flex-grow: 1;
    max-width: 720px;
    margin: 20px auto 40px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    padding: 20px;
  }
  body.dark main#content {
    background: #222;
    box-shadow: 0 0 20px rgba(0,0,0,0.8);
  }
  ul#fileList {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  ul#fileList li {
    padding: 12px 15px;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  body.dark ul#fileList li {
    border-color: #444;
  }
  ul#fileList li:hover {
    background: #e6f2ff;
  }
  body.dark ul#fileList li:hover {
    background: #1a3b6f;
  }
  ul#fileList li:last-child {
    border-bottom: none;
  }
  ul#fileList li .name {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  ul#fileList li .icon {
    font-size: 18px;
    color: #007acc;
  }
  body.dark ul#fileList li .icon {
    color: #90caf9;
  }
  button.playBtn {
    background: #007acc;
    border: none;
    color: white;
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
  }
  button.playBtn:hover {
    background: #005a9e;
  }
  audio#audioPlayer {
    width: 100%;
    max-width: 720px;
    margin: 0 auto 20px;
    display: block;
    border-radius: 8px;
    outline: none;
  }
</style>
</head>
<body>
<header>
  <h1>Music Browser</h1>
  <button id="darkToggle">Dark Mode</button>
</header>
<nav id="breadcrumbs" aria-label="Breadcrumb"></nav>
<main id="content">
  <ul id="fileList"></ul>
</main>
<audio id="audioPlayer" controls></audio>

<script>
  const API_KEY = "AIzaSyCoNrL7Omej-ct3IlB02OjTMhvtVFmy0b0";

  // Root folders from your message
  const ROOT_FOLDERS = [
    { name: "Playboi Carti", id: "1tgOfvE-l9iBiXtzii8Xkx44U6mOwaItK" },
    { name: "Ken Carson", id: "1B3jfYcb7ikY-YiqUWNIFqU9GJd22MeVN" },
    { name: "destroy lonely", id: "1I0-pM0AbW2mSybBc6HVFuYMyFDQ2nasm" }
  ];

  let currentPath = [];

  const breadcrumbsEl = document.getElementById("breadcrumbs");
  const fileListEl = document.getElementById("fileList");
  const audioPlayer = document.getElementById("audioPlayer");
  const darkToggle = document.getElementById("darkToggle");

  function getDownloadUrl(fileId) {
    return `https://drive.google.com/uc?export=download&id=${fileId}`;
  }

  async function fetchFolderContents(folderId) {
    const q = `'${folderId}' in parents and trashed = false`;
    const url = new URL("https://www.googleapis.com/drive/v3/files");
    url.search = new URLSearchParams({
      q,
      key: API_KEY,
      fields: "files(id,name,mimeType)",
      pageSize: 1000,
    });

    try {
      const res = await fetch(url);
      if (!res.ok) {
        throw new Error("Failed to fetch folder contents. Check your API key and folder sharing.");
      }
      const data = await res.json();
      return data.files || [];
    } catch (err) {
      alert(err.message);
      return [];
    }
  }

  function renderBreadcrumbs() {
    breadcrumbsEl.innerHTML = "";

    // Home link
    const homeSpan = document.createElement("span");
    homeSpan.textContent = "Home";
    homeSpan.style.fontWeight = "bold";
    homeSpan.addEventListener("click", () => {
      currentPath = [];
      renderBreadcrumbs();
      renderFolderList(ROOT_FOLDERS);
    });
    breadcrumbsEl.appendChild(homeSpan);

    currentPath.forEach((folder, idx) => {
      const separator = document.createElement("span");
      separator.textContent = " â€º ";
      breadcrumbsEl.appendChild(separator);

      const folderSpan = document.createElement("span");
      folderSpan.textContent = folder.name;
      if (idx === currentPath.length - 1) {
        folderSpan.classList.add("current");
      } else {
        folderSpan.style.cursor = "pointer";
        folderSpan.addEventListener("click", () => {
          currentPath = currentPath.slice(0, idx + 1);
          renderBreadcrumbs();
          loadFolder(currentPath[currentPath.length - 1].id);
        });
      }
      breadcrumbsEl.appendChild(folderSpan);
    });
  }

  function renderFolderList(items) {
    fileListEl.innerHTML = "";
    if (items.length === 0) {
      const li = document.createElement("li");
      li.textContent = "No items found in this folder.";
      li.style.textAlign = "center";
      li.style.color = "#888";
      fileListEl.appendChild(li);
      return;
    }

    items.forEach((item) => {
      // Only show folders and audio files
      if (
        item.mimeType !== "application/vnd.google-apps.folder" &&
        !(item.mimeType && item.mimeType.startsWith("audio/"))
      ) {
        return;
      }

      const li = document.createElement("li");

      const nameDiv = document.createElement("div");
      nameDiv.className = "name";

      const iconSpan = document.createElement("span");
      iconSpan.className = "icon";
      iconSpan.textContent =
        item.mimeType === "application/vnd.google-apps.folder" ? "ðŸ“" : "ðŸŽµ";

      const textSpan = document.createElement("span");
      textSpan.textContent = item.name;

      nameDiv.appendChild(iconSpan);
      nameDiv.appendChild(textSpan);
      li.appendChild(nameDiv);

      if (item.mimeType === "application/vnd.google-apps.folder") {
        li.style.cursor = "pointer";
        li.addEventListener("click", () => {
          currentPath.push({ name: item.name, id: item.id });
          renderBreadcrumbs();
          loadFolder(item.id);
        });
      } else {
        // audio file - add play button
        const playBtn = document.createElement("button");
        playBtn.className = "playBtn";
        playBtn.textContent = "Play";
        playBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          audioPlayer.src = getDownloadUrl(item.id);
          audioPlayer.play().catch(() => {
            alert(
              "Playback failed. This is often due to Google Drive CORS restrictions."
            );
          });
        });
        li.appendChild(playBtn);
      }

      fileListEl.appendChild(li);
    });
  }

  async function loadFolder(folderId) {
    fileListEl.innerHTML = "<li>Loading...</li>";
    const items = await fetchFolderContents(folderId);
    renderFolderList(items);
  }

  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    darkToggle.textContent = document.body.classList.contains("dark")
      ? "Light Mode"
      : "Dark Mode";
  });

  window.onload = () => {
    currentPath = [];
    renderBreadcrumbs();
    renderFolderList(ROOT_FOLDERS);
  };
</script>
</body>
</html>
